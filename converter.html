<!DOCTYPE html>
<html lang="ar" dir="rtl" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محول الصوت - FCP Audio to XML</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Default Settings System -->
    <script src="default-settings.js"></script>
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #1e40af;
            --accent-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --surface-color: #334155;
            --border-color: #475569;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.2);
            --radius: 12px;
            --font-primary: 'Cairo', 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--dark-bg);
            color: var(--text-primary);
            line-height: 1.6;
            padding-top: 80px;
        }

        /* Navigation */
        .navbar {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1rem 0;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }

        .nav-links a:hover {
            color: var(--accent-color);
            background: rgba(6, 182, 212, 0.1);
        }

        .nav-links a.active {
            color: var(--primary-color);
            background: rgba(59, 130, 246, 0.1);
        }

        /* Main Container */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .card-header {
            background: var(--surface-color);
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-header h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .card-header i {
            color: var(--accent-color);
            font-size: 1.5rem;
        }

        .card-body {
            padding: 2rem;
        }

        /* Upload Zone */
        .upload-zone {
            border: 3px dashed var(--border-color);
            border-radius: var(--radius);
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(6, 182, 212, 0.05) 100%);
            position: relative;
            overflow: hidden;
        }

        .upload-zone::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.6s ease;
        }

        .upload-zone:hover::before {
            left: 100%;
        }

        .upload-zone:hover {
            border-color: var(--accent-color);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }

        .upload-zone.dragover {
            border-color: var(--success-color);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(34, 197, 94, 0.1) 100%);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--accent-color);
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .upload-zone h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .upload-zone p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .file-input {
            display: none;
        }

        /* Audio Preview */
        .audio-preview {
            background: var(--surface-color);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid var(--border-color);
            display: none;
        }

        .audio-preview audio {
            width: 100%;
            margin-bottom: 1rem;
        }

        .audio-info {
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: var(--text-secondary);
            background: rgba(0,0,0,0.3);
            padding: 1rem;
            border-radius: 8px;
        }

        /* Form Groups */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: var(--font-primary);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 120px;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 1rem;
            font-family: var(--font-primary);
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #34d399);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(16, 185, 129, 0.3);
        }

        .btn-large {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 700;
            min-height: 60px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .action-buttons {
            text-align: center;
            margin-top: 3rem;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            color: white;
            font-weight: 600;
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success-color), #34d399);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--error-color), #f87171);
        }

        .notification.warning {
            background: linear-gradient(135deg, var(--warning-color), #fbbf24);
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .language-toggle {
                margin-left: auto;
            }

            .container {
                padding: 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .page-header h1 {
                font-size: 2rem;
            }

            .upload-zone {
                padding: 2rem 1rem;
            }

            .upload-icon {
                font-size: 3rem;
            }
            
            .lang-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .nav-container {
                padding: 0 1rem;
            }
            
            .language-toggle {
                padding: 0.2rem;
            }
            
            .lang-btn {
                padding: 0.3rem 0.6rem;
                font-size: 0.75rem;
            }
            
            .page-header h1 {
                font-size: 1.75rem;
            }
            
            .btn-large {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }
        }

        /* RTL Support */
        [dir="rtl"] .nav-links {
            direction: ltr;
        }

        [dir="rtl"] .nav-container {
            flex-direction: row-reverse;
        }

        /* Language Toggle */
        .language-toggle {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--surface-color);
            border-radius: 50px;
            padding: 0.3rem;
            border: 1px solid var(--border-color);
        }

        .lang-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-family: var(--font-primary);
        }

        .lang-btn.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .lang-btn:hover:not(.active) {
            color: var(--accent-color);
            background: rgba(6, 182, 212, 0.1);
        }

        /* Enhanced Animations */
        @keyframes slideInFromRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideInFromLeft {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeInUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .animate-slide-in {
            animation: slideInFromRight 0.6s ease-out;
        }

        [dir="ltr"] .animate-slide-in {
            animation: slideInFromLeft 0.6s ease-out;
        }

        .animate-fade-up {
            animation: fadeInUp 0.8s ease-out;
        }

        /* Language Transition */
        .transitioning {
            transition: all 0.5s ease-in-out;
        }

        /* Enhanced Cards */
        .card {
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: var(--gradient-primary);
            transition: left 0.3s ease;
        }

        .card:hover::before {
            left: 0;
        }

        /* Enhanced Upload Zone */
        .upload-zone {
            position: relative;
            overflow: hidden;
        }

        .upload-zone::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            animation: rotate 4s linear infinite;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .upload-zone:hover::after {
            opacity: 1;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Modern Button Styles */
        .btn {
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        /* Loading States */
        .loading {
            position: relative;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Enhanced Notifications */
        .notification {
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255,255,255,0.3);
            animation: progress 3s linear;
        }

        @keyframes progress {
            from { width: 100%; }
            to { width: 0%; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-film"></i> <span id="logo-text">محول صوت FCP</span>
            </div>
            <ul class="nav-links">
                <li><a href="index.html" id="nav-home">الرئيسية</a></li>
                <li><a href="converter.html" class="active" id="nav-converter">المحول</a></li>
                <li><a href="settings.html" id="nav-settings">الإعدادات</a></li>
                <li><a href="video-library.html" id="nav-library">مكتبة الفيديو</a></li>
            </ul>
            <div class="language-toggle">
                <button class="lang-btn active" onclick="switchLanguage('ar')" id="btn-arabic">العربية</button>
                <button class="lang-btn" onclick="switchLanguage('en')" id="btn-english">English</button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <div class="page-header animate-fade-up">
            <h1 id="main-title">محول الصوت إلى XML</h1>
            <p id="main-subtitle">ارفع ملف الصوت وأدخل النصوص لإنشاء مشروع Final Cut Pro</p>
        </div>

        <!-- Media Upload Section -->
        <div class="card animate-slide-in">
            <div class="card-header">
                <i class="fas fa-music"></i>
                <h3 id="upload-title">رفع الملف الصوتي</h3>
            </div>
            <div class="card-body">
                <div class="upload-zone" onclick="document.getElementById('audioInput').click()">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <h3 id="upload-main-text">رفع ملف صوتي أو فيديو</h3>
                    <p id="upload-support-text">يدعم: MP3, WAV, M4A, AAC, FLAC, OGG, MP4, MOV, AVI</p>
                    <p id="upload-instruction-text">اسحب وأفلت أو اضغط للاختيار</p>
                    <input type="file" id="audioInput" class="file-input" accept=".mp3,.wav,.m4a,.aac,.flac,.ogg,.mp4,.mov,.avi" onchange="handleAudioUpload(event)">
                </div>
                
                <div id="audioPreview" class="audio-preview">
                    <audio controls id="audioPlayer">
                        متصفحك لا يدعم عرض الملفات الصوتية.
                    </audio>
                    <div id="audioInfo" class="audio-info"></div>
                </div>

                <!-- Video Library Integration -->
                <div style="margin-top: 1rem; text-align: center;">
                    <button class="btn btn-primary" onclick="loadFromVideoLibrary()">
                        <i class="fas fa-video"></i> <span id="library-btn-text">تحميل من مكتبة الفيديو</span>
                    </button>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;" id="library-description">
                        اختر من الفيديوهات المرفوعة مسبقاً
                    </p>
                </div>
            </div>
        </div>

        <!-- Text Content Section -->
        <div class="card animate-slide-in" style="animation-delay: 0.2s;">
            <div class="card-header">
                <i class="fas fa-keyboard"></i>
                <h3 id="text-content-title">محتوى النص</h3>
            </div>
            <div class="card-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" id="arabic-text-label">النص العربي الأساسي:</label>
                        <textarea id="arabicText" class="form-control" placeholder="" style="direction: rtl; text-align: right;"></textarea>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;" id="arabic-text-description">
                            النص الرئيسي الذي سيظهر في الترجمة
                        </p>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="repetitive-text-label">المستهل (النص المتكرر):</label>
                        <textarea id="repetitiveText" class="form-control" placeholder="" style="direction: rtl; text-align: right;"></textarea>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;" id="repetitive-text-description">
                            النص الذي سيتم تكراره في المقطع (مثل: يا حسين، لبيك يا حسين، إلخ)
                        </p>
                    </div>

                    <!-- Poetry Processing Settings -->
                    <div class="form-group" style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <i class="fas fa-filter" style="color: var(--primary-color);"></i>
                            <label class="form-label" style="margin: 0;" id="poetry-filter-label">تنقية نصوص القصائد:</label>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
                                <input type="checkbox" id="skipPoetryIntros" checked style="margin: 0;">
                                <span id="skip-intros-text">تجاهل المستهلات</span>
                            </label>
                            <span style="font-size: 0.8rem; color: var(--text-muted);" id="poetry-filter-description">
                                سيتم تجاهل العبارات الافتتاحية والختامية في القصائد
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- XML Output Section -->
        <div class="card animate-slide-in" style="animation-delay: 0.3s; display: none;" id="xmlSection">
            <div class="card-header">
                <i class="fas fa-code"></i>
                <h3 id="xml-title">كود XML المُولد</h3>
            </div>
            <div class="card-body">
                <div class="xml-actions" style="margin-bottom: 1rem; text-align: center;">
                    <button class="btn btn-secondary" onclick="copyXML()" id="copyBtn">
                        <i class="fas fa-copy"></i> <span id="copy-btn-text">نسخ</span>
                    </button>
                    <button class="btn btn-primary" onclick="downloadXML()" id="downloadBtn">
                        <i class="fas fa-download"></i> <span id="download-btn-text">تحميل XML</span>
                    </button>
                </div>
                <div class="xml-code" id="xmlCode" style="background: var(--surface-color); padding: 1rem; border-radius: 8px; font-family: var(--font-mono); font-size: 0.85rem; white-space: pre-wrap; max-height: 400px; overflow-y: auto; border: 1px solid var(--border-color);">
                    <!-- XML code will be populated here -->
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons animate-fade-up" style="animation-delay: 0.4s;">
            <button class="btn btn-success btn-large" onclick="generateXML()" id="generateProjectBtn" disabled>
                <i class="fas fa-magic"></i> <span id="generate-btn-text">توليد ملف XML</span>
            </button>
            <p style="font-size: 0.9rem; color: var(--text-muted); margin-top: 1rem;" id="settings-link-text">
                يمكنك تخصيص الإعدادات المتقدمة من صفحة <a href="settings.html" style="color: var(--accent-color);" id="settings-link">الإعدادات</a>
            </p>
        </div>
    </div>

    <script>
        let audioFile = null;
        let projectData = {
            audio: null,
            arabicText: '',
            repetitiveText: ''
        };

        // Language system
        const translations = {
            ar: {
                title: 'محول الصوت - FCP Audio to XML',
                logoText: 'محول صوت FCP',
                navHome: 'الرئيسية',
                navConverter: 'المحول',
                navPreview: 'المعاينة',
                navSettings: 'الإعدادات',
                navLibrary: 'مكتبة الفيديو',
                mainTitle: 'محول الصوت إلى XML',
                mainSubtitle: 'ارفع ملف الصوت وأدخل النصوص لإنشاء مشروع Final Cut Pro',
                uploadTitle: 'رفع الملف الصوتي',
                uploadMainText: 'رفع ملف صوتي أو فيديو',
                uploadSupportText: 'يدعم: MP3, WAV, M4A, AAC, FLAC, OGG, MP4, MOV, AVI',
                uploadInstructionText: 'اسحب وأفلت أو اضغط للاختيار',
                libraryBtnText: 'تحميل من مكتبة الفيديو',
                libraryDescription: 'اختر من الفيديوهات المرفوعة مسبقاً',
                textContentTitle: 'محتوى النص',
                arabicTextLabel: 'النص العربي الأساسي:',
                arabicTextPlaceholder: 'أدخل النص العربي هنا...',
                arabicTextDescription: 'النص الرئيسي الذي سيظهر في الترجمة',
                repetitiveTextLabel: 'المستهل (النص المتكرر):',
                repetitiveTextPlaceholder: 'أدخل النص المتكرر هنا...',
                repetitiveTextDescription: 'النص الذي سيتم تكراره في المقطع (مثل: يا حسين، لبيك يا حسين، إلخ)',
                poetryFilterLabel: 'تنقية نصوص القصائد:',
                skipIntrosText: 'تجاهل المستهلات',
                poetryFilterDescription: 'سيتم تجاهل العبارات الافتتاحية والختامية في القصائد',
                generateBtnText: 'توليد ملف XML',
                settingsLinkText: 'يمكنك تخصيص الإعدادات المتقدمة من صفحة',
                settingsLink: 'الإعدادات',
                xmlTitle: 'كود XML المُولد',
                copyBtnText: 'نسخ',
                downloadBtnText: 'تحميل XML',
                // Notifications
                fileUploadSuccess: 'تم تحميل الملف الصوتي بنجاح!',
                invalidFileType: 'يرجى اختيار ملف صوتي أو فيديو',
                noAudioFile: 'يرجى رفع ملف صوتي أولاً',
                noTextContent: 'يرجى إدخال نص عربي أو نص متكرر',
                xmlGenerated: 'تم توليد ملف XML بنجاح!',
                xmlCopied: 'تم نسخ كود XML!',
                xmlCopyFailed: 'فشل في نسخ كود XML',
                xmlDownloaded: 'تم تحميل ملف XML بنجاح!',
                noXmlToDownload: 'لا يوجد كود XML للتحميل',
                libraryComingSoon: 'ميزة مكتبة الفيديو ستكون متاحة قريباً',
                // Audio info
                fileLabel: 'الملف:',
                sizeLabel: 'الحجم:',
                typeLabel: 'النوع:',
                statusLabel: 'الحالة:',
                readyStatus: 'جاهز للتحويل',
                megabytes: 'ميجابايت'
            },
            en: {
                title: 'Audio Converter - FCP Audio to XML',
                logoText: 'FCP Audio Converter',
                navHome: 'Home',
                navConverter: 'Converter',
                navPreview: 'Preview',
                navSettings: 'Settings',
                navLibrary: 'Video Library',
                mainTitle: 'Audio to XML Converter',
                mainSubtitle: 'Upload audio file and enter text to create Final Cut Pro project',
                uploadTitle: 'Upload Audio File',
                uploadMainText: 'Upload Audio or Video File',
                uploadSupportText: 'Supports: MP3, WAV, M4A, AAC, FLAC, OGG, MP4, MOV, AVI',
                uploadInstructionText: 'Drag and drop or click to select',
                libraryBtnText: 'Load from Video Library',
                libraryDescription: 'Choose from previously uploaded videos',
                textContentTitle: 'Text Content',
                arabicTextLabel: 'Main Arabic Text:',
                arabicTextPlaceholder: 'Enter Arabic text here...',
                arabicTextDescription: 'The main text that will appear in the subtitles',
                repetitiveTextLabel: 'Repetitive Text:',
                repetitiveTextPlaceholder: 'Enter repetitive text here...',
                repetitiveTextDescription: 'Text that will be repeated in the clip (e.g., Ya Hussein, Labbaik Ya Hussein, etc.)',
                poetryFilterLabel: 'Poetry Text Filtering:',
                skipIntrosText: 'Skip Introductory Phrases',
                poetryFilterDescription: 'Will ignore introductory and concluding phrases in poems',
                generateBtnText: 'Generate XML File',
                settingsLinkText: 'You can customize advanced settings from the',
                settingsLink: 'Settings',
                xmlTitle: 'Generated XML Code',
                copyBtnText: 'Copy',
                downloadBtnText: 'Download XML',
                // Notifications
                fileUploadSuccess: 'Audio file uploaded successfully!',
                invalidFileType: 'Please select an audio or video file',
                noAudioFile: 'Please upload an audio file first',
                noTextContent: 'Please enter Arabic text or repetitive text',
                xmlGenerated: 'XML file generated successfully!',
                xmlCopied: 'XML code copied!',
                xmlCopyFailed: 'Failed to copy XML code',
                xmlDownloaded: 'XML file downloaded successfully!',
                noXmlToDownload: 'No XML code to download',
                libraryComingSoon: 'Video library feature will be available soon',
                // Audio info
                fileLabel: 'File:',
                sizeLabel: 'Size:',
                typeLabel: 'Type:',
                statusLabel: 'Status:',
                readyStatus: 'Ready to convert',
                megabytes: 'MB'
            }
        };

        let currentLanguage = 'ar';

        // Language switching function
        function switchLanguage(lang) {
            if (lang === currentLanguage) return;
            
            currentLanguage = lang;
            const htmlRoot = document.getElementById('html-root');
            const t = translations[lang];
            
            // Add transition effect
            document.body.classList.add('transitioning');
            
            // Update HTML attributes
            htmlRoot.lang = lang;
            htmlRoot.dir = lang === 'ar' ? 'rtl' : 'ltr';
            
            // Update document title
            document.title = t.title;
            
            // Update navigation
            document.getElementById('logo-text').textContent = t.logoText;
            document.getElementById('nav-home').textContent = t.navHome;
            document.getElementById('nav-converter').textContent = t.navConverter;
            document.getElementById('nav-settings').textContent = t.navSettings;
            document.getElementById('nav-library').textContent = t.navLibrary;
            
            // Update main content
            document.getElementById('main-title').textContent = t.mainTitle;
            document.getElementById('main-subtitle').textContent = t.mainSubtitle;
            document.getElementById('upload-title').textContent = t.uploadTitle;
            document.getElementById('upload-main-text').textContent = t.uploadMainText;
            document.getElementById('upload-support-text').textContent = t.uploadSupportText;
            document.getElementById('upload-instruction-text').textContent = t.uploadInstructionText;
            document.getElementById('library-btn-text').textContent = t.libraryBtnText;
            document.getElementById('library-description').textContent = t.libraryDescription;
            document.getElementById('text-content-title').textContent = t.textContentTitle;
            document.getElementById('arabic-text-label').textContent = t.arabicTextLabel;
            document.getElementById('arabic-text-description').textContent = t.arabicTextDescription;
            document.getElementById('repetitive-text-label').textContent = t.repetitiveTextLabel;
            document.getElementById('repetitive-text-description').textContent = t.repetitiveTextDescription;
            document.getElementById('poetry-filter-label').textContent = t.poetryFilterLabel;
            document.getElementById('skip-intros-text').textContent = t.skipIntrosText;
            document.getElementById('poetry-filter-description').textContent = t.poetryFilterDescription;
            document.getElementById('generate-btn-text').textContent = t.generateBtnText;
            document.getElementById('settings-link-text').innerHTML = t.settingsLinkText + ' <a href="settings.html" style="color: var(--accent-color);" id="settings-link">' + t.settingsLink + '</a>';
            
            // Update XML section texts if visible
            const xmlTitleElement = document.getElementById('xml-title');
            const copyBtnElement = document.getElementById('copy-btn-text');
            const downloadBtnElement = document.getElementById('download-btn-text');
            
            if (xmlTitleElement) xmlTitleElement.textContent = t.xmlTitle;
            if (copyBtnElement) copyBtnElement.textContent = t.copyBtnText;
            if (downloadBtnElement) downloadBtnElement.textContent = t.downloadBtnText;
            
            // Update placeholders
            document.getElementById('arabicText').placeholder = t.arabicTextPlaceholder;
            document.getElementById('repetitiveText').placeholder = t.repetitiveTextPlaceholder;
            
            // Update text direction for input fields
            const arabicTextArea = document.getElementById('arabicText');
            const repetitiveTextArea = document.getElementById('repetitiveText');
            
            if (lang === 'ar') {
                arabicTextArea.style.direction = 'rtl';
                arabicTextArea.style.textAlign = 'right';
                repetitiveTextArea.style.direction = 'rtl';
                repetitiveTextArea.style.textAlign = 'right';
            } else {
                arabicTextArea.style.direction = 'ltr';
                arabicTextArea.style.textAlign = 'left';
                repetitiveTextArea.style.direction = 'ltr';
                repetitiveTextArea.style.textAlign = 'left';
            }
            
            // Update language toggle buttons
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(lang === 'ar' ? 'btn-arabic' : 'btn-english').classList.add('active');
            
            // Save language preference
            localStorage.setItem('preferredLanguage', lang);
            
            // Remove transition effect
            setTimeout(() => {
                document.body.classList.remove('transitioning');
            }, 500);
        }

        // Enhanced notification system with language support
        function showNotification(messageKey, type = 'success') {
            const message = translations[currentLanguage][messageKey] || messageKey;
            const notification = document.createElement('div');
            notification.className = `notification ${type} show`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Drag and drop functionality
        const uploadZone = document.querySelector('.upload-zone');
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleAudioFile(files[0]);
            }
        });

        // Audio upload handling with enhanced UX
        function handleAudioUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            handleAudioFile(file);
        }

        function handleAudioFile(file) {
            // Check if file is audio or video
            const validTypes = ['audio/', 'video/'];
            if (!validTypes.some(type => file.type.startsWith(type))) {
                showNotification('invalidFileType', 'error');
                return;
            }

            // Add loading state
            const generateBtn = document.getElementById('generateProjectBtn');
            generateBtn.classList.add('loading');

            audioFile = file;
            projectData.audio = file;

            // Create URL for preview
            const audioURL = URL.createObjectURL(file);
            
            // Show audio preview
            const audioPreview = document.getElementById('audioPreview');
            const audioPlayer = document.getElementById('audioPlayer');
            const audioInfo = document.getElementById('audioInfo');
            
            audioPlayer.src = audioURL;
            
            const t = translations[currentLanguage];
            audioInfo.innerHTML = `
                <strong>${t.fileLabel}</strong> ${file.name}<br>
                <strong>${t.sizeLabel}</strong> ${(file.size / (1024 * 1024)).toFixed(2)} ${t.megabytes}<br>
                <strong>${t.typeLabel}</strong> ${file.type}<br>
                <strong>${t.statusLabel}</strong> <span style="color: var(--success-color);">${t.readyStatus}</span>
            `;
            
            audioPreview.style.display = 'block';
            
            // Remove loading state and enable generate button
            setTimeout(() => {
                generateBtn.classList.remove('loading');
                generateBtn.disabled = false;
            }, 500);
            
            showNotification('fileUploadSuccess', 'success');
        }

        // Load from video library
        function loadFromVideoLibrary() {
            showNotification('libraryComingSoon', 'warning');
        }

        // Generate Final Cut Pro XML with enhanced UX
        let generatedXML = '';

        // Text processing function to handle poetry intro filtering
        function processPoetryText(text, settings) {
            if (!text || !settings.skipPoetryIntros) {
                return text;
            }

            // Split text into lines for processing
            let lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            
            // Default patterns to skip
            const skipPatterns = [
                ...(settings.poetryIntroPatterns || []),
                ...(settings.customSkipPatterns || [])
            ];

            // Function to check if a line should be skipped
            function shouldSkipLine(line) {
                return skipPatterns.some(pattern => {
                    return line.includes(pattern) || 
                           line.startsWith(pattern) || 
                           line.endsWith(pattern);
                });
            }

            // Filter beginning intros if enabled
            if (settings.skipBeginningIntros) {
                while (lines.length > 0 && shouldSkipLine(lines[0])) {
                    lines.shift();
                }
            }

            // Filter ending intros if enabled  
            if (settings.skipEndingIntros) {
                while (lines.length > 0 && shouldSkipLine(lines[lines.length - 1])) {
                    lines.pop();
                }
            }

            // Return processed text
            return lines.join('\n');
        }

        function generateXML() {
            // Get text values
            const arabicTextRaw = document.getElementById('arabicText').value.trim();
            const repetitiveTextRaw = document.getElementById('repetitiveText').value.trim();
            
            if (!audioFile) {
                showNotification('noAudioFile', 'error');
                return;
            }
            
            if (!arabicTextRaw && !repetitiveTextRaw) {
                showNotification('noTextContent', 'error');
                return;
            }

            // Add loading state
            const generateBtn = document.getElementById('generateProjectBtn');
            generateBtn.classList.add('loading');

            // Load settings from settings page (localStorage)
            const settings = loadSettings();
            
            // Override poetry filtering setting with current checkbox state
            settings.skipPoetryIntros = document.getElementById('skipPoetryIntros').checked;
            
            // Process texts to remove poetry intros if enabled
            const arabicText = processPoetryText(arabicTextRaw, settings);
            const repetitiveText = processPoetryText(repetitiveTextRaw, settings);
            
            // Get default settings for fonts and positions
            const globalSettings = typeof getConverterSettings !== 'undefined' ? getConverterSettings() : {};
            const englishFont = globalSettings.englishFont || 'Helvetica';
            const englishFontSize = globalSettings.englishFontSize || 25;
            const englishPositionY = globalSettings.englishPositionY || -420;
            
            const arabicFont = globalSettings.arabicFont || 'Arial';
            const arabicFontSize = globalSettings.arabicFontSize || 34;
            const arabicPositionY = globalSettings.arabicPositionY || -381;

            // Create project data
            const projectData = {
                arabicText: arabicText,
                englishText: repetitiveText, // Using repetitive text as English
                audioFileName: audioFile.name,
                startTime: settings.startTime || 0,
                duration: settings.duration || 5,
                displayMode: settings.displayMode || 'arabic',
                previewResolution: settings.previewResolution || '1920x1080',
                frameRate: 25
            };

            const resolution = projectData.previewResolution;
            const frameRate = projectData.frameRate;
            const [width, height] = resolution.split('x').map(Number);
            
            // Calculate frame-based timing
            const totalDurationFrames = Math.ceil(projectData.duration * frameRate);
            const startFrames = Math.floor(projectData.startTime * frameRate);

            let xml = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE fcpxml>
<fcpxml version="1.10">
    <resources>
        <format id="r1" name="FFVideoFormat${height}p${frameRate}" frameDuration="1/${frameRate}s" width="${width}" height="${height}" colorSpace="1-1-1 (Rec. 709)"/>
        <effect id="e1" name="Basic Title" uid=".../Titles.localized/Bumper:Opener.localized/Basic Title.localized/Basic Title.moti"/>
        <asset id="a1" name="${escapeXML(projectData.audioFileName)}" uid="${generateUID()}" start="0/1s" duration="${totalDurationFrames}/${frameRate}s" hasVideo="0" hasAudio="1">
            <media-rep kind="original-media" src="file:///${escapeXML(projectData.audioFileName)}"/>
        </asset>
        
        <!-- Text style definitions -->
        <text-style-def id="ts1">
            <text-style font="${arabicFont}" fontSize="${arabicFontSize}" fontFace="Regular" fontColor="1 1 1 1" alignment="center"/>
        </text-style-def>
        <text-style-def id="ts2">
            <text-style font="${englishFont}" fontSize="${englishFontSize}" fontFace="Regular" fontColor="1 1 1 1" alignment="center"/>
        </text-style-def>
    </resources>
    <library location="file:///Users/user/Movies/">
        <event name="Subtitle Project ${new Date().toLocaleDateString()}">
            <project name="Arabic English Subtitles" uid="${generateUID()}" modDate="${new Date().toISOString()}">
                <sequence format="r1" duration="${totalDurationFrames}/${frameRate}s" tcStart="0/1s" tcFormat="NDF" audioLayout="stereo" audioRate="48k">
                    <spine>
                        <!-- Audio Track -->
                        <asset-clip name="${escapeXML(projectData.audioFileName)}" ref="a1" offset="0/1s" duration="${totalDurationFrames}/${frameRate}s" tcFormat="NDF" audioRole="dialogue"/>
                        
                        <!-- Gap for subtitle tracks -->
                        <gap name="Gap" offset="0/1s" duration="${totalDurationFrames}/${frameRate}s">`;

            // Add subtitle titles based on display mode
            if (projectData.displayMode === 'both' || projectData.displayMode === 'arabic') {
                xml += `
                            <title name="Arabic Text" offset="${startFrames}/${frameRate}s" duration="${totalDurationFrames - startFrames}/${frameRate}s" start="3600/1s">
                                <param name="Position" key="9999/999166631/999166633/1/100/101" value="0 ${arabicPositionY}"/>
                                <param name="Alignment" key="9999/999166631/999166633/2/351" value="1 (Center)"/>
                                <text>
                                    <text-style ref="ts1">${escapeXML(projectData.arabicText)}</text-style>
                                </text>
                            </title>`;
            }

            if (projectData.displayMode === 'both' || projectData.displayMode === 'repetitive') {
                xml += `
                            <title name="English Text" offset="${startFrames}/${frameRate}s" duration="${totalDurationFrames - startFrames}/${frameRate}s" start="3600/1s">
                                <param name="Position" key="9999/999166631/999166633/1/100/101" value="0 ${englishPositionY}"/>
                                <param name="Alignment" key="9999/999166631/999166633/2/351" value="1 (Center)"/>
                                <text>
                                    <text-style ref="ts2">${escapeXML(projectData.englishText)}</text-style>
                                </text>
                            </title>`;
            }
            
            // Handle alternating mode (Arabic first, then English)
            if (projectData.displayMode === 'alternating') {
                const halfDuration = Math.floor((totalDurationFrames - startFrames) / 2);
                const secondHalfStart = startFrames + halfDuration;
                
                xml += `
                            <title name="Arabic Text" offset="${startFrames}/${frameRate}s" duration="${halfDuration}/${frameRate}s" start="3600/1s">
                                <param name="Position" key="9999/999166631/999166633/1/100/101" value="0 ${arabicPositionY}"/>
                                <param name="Alignment" key="9999/999166631/999166633/2/351" value="1 (Center)"/>
                                <text>
                                    <text-style ref="ts1">${escapeXML(projectData.arabicText)}</text-style>
                                </text>
                            </title>
                            <title name="English Text" offset="${secondHalfStart}/${frameRate}s" duration="${totalDurationFrames - secondHalfStart}/${frameRate}s" start="3600/1s">
                                <param name="Position" key="9999/999166631/999166633/1/100/101" value="0 ${englishPositionY}"/>
                                <param name="Alignment" key="9999/999166631/999166633/2/351" value="1 (Center)"/>
                                <text>
                                    <text-style ref="ts2">${escapeXML(projectData.englishText)}</text-style>
                                </text>
                            </title>`;
            }

            xml += `
                        </gap>
                    </spine>
                </sequence>
            </project>
        </event>
    </library>
</fcpxml>

<!-- 
إرشادات الاستخدام:
1. احفظ هذا الملف بامتداد .fcpxml
2. ضع الملف الصوتي في نفس مجلد ملف XML أو حدث مسار الصوت في السطر الخاص بـ media-rep
3. افتح Final Cut Pro واسحب ملف XML إلى البرنامج
4. ستجد المشروع في مكتبة Final Cut Pro
5. يمكنك تعديل النصوص والخطوط والمواضع حسب الحاجة

Instructions for use:
1. Save this file with .fcpxml extension
2. Place audio file in same folder as XML or update audio path in media-rep line
3. Open Final Cut Pro and drag XML file into the application
4. Project will appear in Final Cut Pro library
5. You can edit texts, fonts, and positions as needed
-->`;

            generatedXML = xml;
            document.getElementById('xmlCode').textContent = xml;
            
            // Show XML section
            document.getElementById('xmlSection').style.display = 'block';
            
            // Remove loading state
            setTimeout(() => {
                generateBtn.classList.remove('loading');
                showNotification('xmlGenerated', 'success');
                
                // Scroll to XML section
                document.getElementById('xmlSection').scrollIntoView({ behavior: 'smooth' });
            }, 1000);
        }

        // Copy XML to clipboard
        function copyXML() {
            if (!generatedXML) {
                showNotification('noXmlToDownload', 'error');
                return;
            }

            navigator.clipboard.writeText(generatedXML).then(() => {
                showNotification('xmlCopied', 'success');
            }).catch(() => {
                showNotification('xmlCopyFailed', 'error');
            });
        }

        // Download XML file
        function downloadXML() {
            if (!generatedXML) {
                showNotification('noXmlToDownload', 'error');
                return;
            }

            const blob = new Blob([generatedXML], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `fcp_subtitle_project_${Date.now()}.fcpxml`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('xmlDownloaded', 'success');
        }

        // Utility functions
        function generateUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function escapeXML(text) {
            return text.replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;')
                      .replace(/"/g, '&quot;')
                      .replace(/'/g, '&#39;');
        }

        // Load settings from localStorage
        function loadSettings() {
            const defaultSettings = {
                fadeInDuration: 0.5,
                fadeOutDuration: 0.5,
                fadeInType: 'ease-in-out',
                fadeOutType: 'ease-in-out',
                animationStyle: 'fade',
                animationSpeed: 1,
                blurAmount: 0,
                shadowIntensity: 50,
                startTime: 0,
                duration: 5,
                displayMode: 'arabic',
                previewResolution: '1920x1080',
                audioSync: 'start',
                autoTiming: true,
                speechSpeed: 'normal',
                sentenceDuration: 4,
                detectRepeats: true,
                voiceThreshold: 0.3,
                autoSyncBeats: true,
                // Translation settings
                skipPoetryIntros: true,
                poetryIntroPatterns: ['مستهل', 'يا حسين', 'لبيك يا حسين', 'السلام عليك', 'صلى الله عليه وآله'],
                skipBeginningIntros: true,
                skipEndingIntros: true,
                customSkipPatterns: []
            };
            
            try {
                const saved = localStorage.getItem('converterSettings');
                return saved ? { ...defaultSettings, ...JSON.parse(saved) } : defaultSettings;
            } catch {
                return defaultSettings;
            }
        }

        // Notification system
        function showNotification(messageKey, type = 'success') {
            const t = translations[currentLanguage];
            const messages = {
                poetryFilterEnabled: {
                    ar: 'تم تفعيل تنقية نصوص القصائد - سيتم تجاهل المستهلات',
                    en: 'Poetry text filtering enabled - introductory phrases will be ignored'
                },
                poetryFilterDisabled: {
                    ar: 'تم إلغاء تنقية نصوص القصائد - سيتم إدراج جميع النصوص',
                    en: 'Poetry text filtering disabled - all text will be included'
                },
                noAudioFile: {
                    ar: 'يرجى رفع ملف صوتي أولاً',
                    en: 'Please upload an audio file first'
                },
                noTextContent: {
                    ar: 'يرجى إدخال النص العربي أو النص المتكرر',
                    en: 'Please enter Arabic text or repetitive text'
                },
                xmlGenerated: {
                    ar: 'تم توليد ملف XML بنجاح!',
                    en: 'XML file generated successfully!'
                },
                xmlCopied: {
                    ar: 'تم نسخ XML إلى الحافظة',
                    en: 'XML copied to clipboard'
                },
                xmlDownloaded: {
                    ar: 'تم تحميل ملف XML',
                    en: 'XML file downloaded'
                },
                fileUploadSuccess: {
                    ar: 'تم رفع الملف بنجاح',
                    en: 'File uploaded successfully'
                }
            };
            
            const message = messages[messageKey] ? messages[messageKey][currentLanguage] : messageKey;
            
            const notification = document.createElement('div');
            notification.className = `notification ${type} show`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Initialize on page load with enhanced features
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved language preference
            const savedLanguage = localStorage.getItem('preferredLanguage') || 'ar';
            if (savedLanguage !== 'ar') {
                switchLanguage(savedLanguage);
            }
            
            // Load saved text content
            const savedArabic = localStorage.getItem('savedArabicText');
            const savedRepetitive = localStorage.getItem('savedRepetitiveText');
            
            if (savedArabic) {
                document.getElementById('arabicText').value = savedArabic;
            }
            
            if (savedRepetitive) {
                document.getElementById('repetitiveText').value = savedRepetitive;
            }
            
            // Auto-save text content with debouncing
            let saveTimeout;
            
            function autoSave(key, value) {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    localStorage.setItem(key, value);
                }, 500);
            }
            
            document.getElementById('arabicText').addEventListener('input', function() {
                autoSave('savedArabicText', this.value);
            });
            
            document.getElementById('repetitiveText').addEventListener('input', function() {
                autoSave('savedRepetitiveText', this.value);
            });
            
            // Handle poetry filtering checkbox
            document.getElementById('skipPoetryIntros').addEventListener('change', function() {
                localStorage.setItem('skipPoetryIntros', this.checked);
                
                // Show preview of filtering effect
                if (this.checked) {
                    showNotification('poetryFilterEnabled', 'info');
                } else {
                    showNotification('poetryFilterDisabled', 'warning');
                }
            });
            
            // Load saved poetry filter setting
            const savedSkipIntros = localStorage.getItem('skipPoetryIntros');
            if (savedSkipIntros !== null) {
                document.getElementById('skipPoetryIntros').checked = savedSkipIntros === 'true';
            }
            
            // Add smooth scroll behavior
            document.documentElement.style.scrollBehavior = 'smooth';
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + L to switch language
                if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                    e.preventDefault();
                    switchLanguage(currentLanguage === 'ar' ? 'en' : 'ar');
                }
                
                // Ctrl/Cmd + Enter to generate XML
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    const generateBtn = document.getElementById('generateProjectBtn');
                    if (!generateBtn.disabled) {
                        generateXML();
                    }
                }
            });
        });
    </script>
</body>
</html>
